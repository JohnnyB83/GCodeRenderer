<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>

<script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three/build/three.module.js",
      "three/addons/": "https://unpkg.com/three/examples/jsm/"
    }
  }
</script>


  <style> body { margin: 0; } </style> 
  </head> 
    <body> 
      <script type="module">

        import * as THREE from 'https://unpkg.com/three/build/three.module.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        const camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 2000 );
        const renderer = new THREE.WebGLRenderer(); renderer.setSize( window.innerWidth, window.innerHeight );
        const controls = new OrbitControls( camera, renderer.domElement );

        document.body.appendChild( renderer.domElement );

				controls.screenSpacePanning = false;

				controls.minDistance = 10;
				controls.maxDistance = 1000;

        controls.minPolarAngle = Math.PI / 2;

        controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
				controls.dampingFactor = 0.05;

        const scene = new THREE.Scene();

        camera.position.set(125, -200, 250);
        controls.target = new THREE.Vector3(125, 105, 105);
        controls.update();

        const material = new THREE.LineBasicMaterial( { color: 0x00ff00 } );

        // Points for 3D printer enclosure
        const points = [];
        points.push(new THREE.Vector3(0, 0, 0 ));
        points.push(new THREE.Vector3(250, 0, 0 ));
        points.push(new THREE.Vector3(250, 210, 0 ));
        points.push(new THREE.Vector3(0, 210, 0 ));
        points.push(new THREE.Vector3(0, 0, 0 ));

        points.push(new THREE.Vector3(0, 0, 210 ));
        points.push(new THREE.Vector3(250, 0, 210 ));

        // Vertical line
        points.push(new THREE.Vector3(250, 0, 0 ));
        points.push(new THREE.Vector3(250, 0, 210 ));

        points.push(new THREE.Vector3(250, 210, 210 ));
        // Vertical line
        points.push(new THREE.Vector3(250, 210, 0 ));
        points.push(new THREE.Vector3(250, 210, 210 ));

        points.push(new THREE.Vector3(0, 210, 210 ));

        // Vertical line
        points.push(new THREE.Vector3(0, 210, 0 ));
        points.push(new THREE.Vector3(0, 210, 210 ));

        points.push(new THREE.Vector3(0, 0, 210 ));

        const geometry = new THREE.BufferGeometry().setFromPoints( points );
        const line = new THREE.Line( geometry, material );

        // Test Gcode
        const p = [];
        p.push(new THREE.Vector3(106.603, 87.289, 0 ) );
        p.push(new THREE.Vector3(107.186, 86.148, 0 ) );
        p.push(new THREE.Vector3(108.101, 85.522, 0 ) );
        p.push(new THREE.Vector3(109.549, 84.909, 0 ) );
        p.push(new THREE.Vector3(110.757, 84.667 , 0 ) );
        p.push(new THREE.Vector3(138.665, 84.628 , 0 ) );
        
        const geo = new THREE.BufferGeometry().setFromPoints( p );
        const testLine = new THREE.Line( geo, material );

        // Nozzle
        const cGeo = new THREE.CylinderGeometry( 2, 2, 10, 10 );
        const cMaterial = new THREE.MeshBasicMaterial( {color: 0x3E424B, transparent: true, opacity: 0.4} );
        const cylinder = new THREE.Mesh( cGeo, cMaterial );
        const coneGeometry = new THREE.ConeGeometry( 3, 6, 10 );
        const cone = new THREE.Mesh( coneGeometry, cMaterial );

        cylinder.rotation.x = Math.PI / 2;
        cone.rotation.x = - Math.PI / 2;
        cylinder.position.set(138.665, 84.628 , 10);
        cone.position.set(138.665, 84.628 , 3);
        
        scene.add( line );
        scene.add(testLine)
        scene.add( cylinder );
        scene.add( cone );

        function animate() {
          requestAnimationFrame( animate );
          controls.update();
          renderer.render( scene, camera );
        }
        // if ( WebGL.isWebGLAvailable() ) {
          animate();
        // }
      
        </script>
      </body>
    </html>
